{"ast":null,"code":"import { NbMessage } from 'src/app/_dtos/chat/NbMessage';\nimport { MessageRequest } from \"../../_dtos/chat/MessageRequest\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/_services/chat.service\";\nimport * as i2 from \"../../_services/messages.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"src/app/_services/user.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@nebular/theme\";\nfunction ChatDetailComponent_nb_chat_1_nb_chat_message_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"nb-chat-message\", 5);\n  }\n  if (rf & 2) {\n    const msg_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"type\", msg_r2.type)(\"message\", msg_r2.text)(\"reply\", msg_r2.reply)(\"sender\", msg_r2.senderName)(\"date\", msg_r2.date)(\"files\", msg_r2.files)(\"quote\", msg_r2.quote)(\"latitude\", msg_r2.latitude)(\"longitude\", msg_r2.longitude)(\"avatar\", msg_r2.avatar);\n  }\n}\nfunction ChatDetailComponent_nb_chat_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"nb-chat\", 2);\n    i0.ɵɵtemplate(1, ChatDetailComponent_nb_chat_1_nb_chat_message_1_Template, 1, 10, \"nb-chat-message\", 3);\n    i0.ɵɵelementStart(2, \"nb-chat-form\", 4);\n    i0.ɵɵlistener(\"send\", function ChatDetailComponent_nb_chat_1_Template_nb_chat_form_send_2_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.sendMessage($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"title\", ctx_r0.friendProfile.userName);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.messages);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"dropFiles\", true);\n  }\n}\nlet ChatDetailComponent = /*#__PURE__*/(() => {\n  class ChatDetailComponent {\n    constructor(chatService, messageService, router, route, userService) {\n      this.chatService = chatService;\n      this.messageService = messageService;\n      this.router = router;\n      this.route = route;\n      this.userService = userService;\n      this.messages = [];\n      this.route.params.subscribe(params => {\n        this.friendId = params['id'];\n        if (this.subscription) this.subscription.unsubscribe();\n        this.myProfile = this.userService.getProfile();\n        this.friendProfile = this.chatService.getFriend(Number(this.friendId));\n        this.getChat();\n      });\n      this.messageService.nbMessages.subscribe(message => {\n        this.messages.push(...message.slice(this.messages.length, message.length));\n      });\n    }\n    ngOnInit() {}\n    getChat() {\n      this.messages = [];\n      this.subscription = this.messageService.fetchMessages(this.friendId).subscribe(msgs => {\n        let messages = msgs.map(msg => {\n          let nm = new NbMessage(msg);\n          if (msg.senderId == this.myProfile.id) {\n            nm.updateUser(this.myProfile.userName, this.myProfile.imageUrl, true);\n          } else {\n            nm.updateUser(this.friendProfile.userName, this.friendProfile.imageUrl, false);\n          }\n          return nm;\n        });\n        this.messages.push(...messages.slice(this.messages.length, messages.length));\n      });\n    }\n    sendMessage(event) {\n      const files = !event.files ? [] : event.files;\n      let messageRequest = new MessageRequest(this.friendId, event.message, null);\n      this.messageService.createMessage(messageRequest, files);\n    }\n  }\n  ChatDetailComponent.ɵfac = function ChatDetailComponent_Factory(t) {\n    return new (t || ChatDetailComponent)(i0.ɵɵdirectiveInject(i1.ChatService), i0.ɵɵdirectiveInject(i2.MessagesService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i4.UserService));\n  };\n  ChatDetailComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ChatDetailComponent,\n    selectors: [[\"app-chat-detail\"]],\n    decls: 2,\n    vars: 1,\n    consts: [[1, \"h-100\"], [\"status\", \"basic\", \"scrollBottom\", \"true\", \"style\", \"height: 90vh;\", 3, \"title\", 4, \"ngIf\"], [\"status\", \"basic\", \"scrollBottom\", \"true\", 2, \"height\", \"90vh\", 3, \"title\"], [3, \"type\", \"message\", \"reply\", \"sender\", \"date\", \"files\", \"quote\", \"latitude\", \"longitude\", \"avatar\", 4, \"ngFor\", \"ngForOf\"], [3, \"dropFiles\", \"send\"], [3, \"type\", \"message\", \"reply\", \"sender\", \"date\", \"files\", \"quote\", \"latitude\", \"longitude\", \"avatar\"]],\n    template: function ChatDetailComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtemplate(1, ChatDetailComponent_nb_chat_1_Template, 3, 3, \"nb-chat\", 1);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.friendProfile);\n      }\n    },\n    dependencies: [i5.NgForOf, i5.NgIf, i6.NbChatComponent, i6.NbChatMessageComponent, i6.NbChatFormComponent]\n  });\n  return ChatDetailComponent;\n})();\nexport { ChatDetailComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}